{
    "microservice": "agent-client-relationships",
    "controller": "ItsaPostSignupController",
    "apis": [
        {
            "endpoint": "POST /itsa-post-signup/create-relationship/:nino",
            "description": "Creates an ITSA relationship for a client after they have signed up, by either converting a partial-auth relationship or copying a legacy SA relationship.",
            "interactions": [
                {
                    "step": 1,
                    "type": "API Call",
                    "service": "if-or-hip",
                    "method": "GET",
                    "path": "/registration/individual/nino/:nino",
                    "database": null,
                    "operation": null,
                    "description": "Get the client's MTDITID from IF/HIP using their NINO."
                },
                {
                    "step": 2,
                    "type": "Database",
                    "service": null,
                    "method": null,
                    "path": null,
                    "database": "agent-client-relationships-db (partial-auth)",
                    "operation": "Read/Update",
                    "description": "Check for a partial-auth record and attempt to create a full relationship from it."
                },
                {
                    "step": 3,
                    "type": "API Call",
                    "service": "des",
                    "method": "GET",
                    "path": "/registration/relationship/nino/:nino",
                    "database": null,
                    "operation": null,
                    "description": "If no partial-auth, check for a legacy SA relationship in DES."
                },
                {
                    "step": 4,
                    "type": "API Call",
                    "service": "enrolment-store-proxy",
                    "method": "POST",
                    "path": "/enrolment-store-proxy/enrolment-store/groups/:groupId/enrolments/:enrolmentKey",
                    "database": null,
                    "operation": null,
                    "description": "If a legacy relationship is found, create the new MTD-IT relationship by allocating the enrolment in Enrolment Store Proxy."
                }
            ]
        }
    ]
}